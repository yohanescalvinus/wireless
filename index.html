<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Jemaat Baru - WhatsApp Message Generator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.4rem;
            padding-bottom: 5px;
            border-bottom: 1px dashed #3498db;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .required::after {
            content: " *";
            color: #e74c3c;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .member-item {
            background-color: #f9f9f9;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .remove-member {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .remove-member:hover {
            background-color: #c0392b;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-whatsapp {
            background-color: #25D366;
        }
        
        .btn-whatsapp:hover {
            background-color: #1da851;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .preview-section {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 20px;
            margin-top: 30px;
            border: 1px dashed #ddd;
        }
        
        .preview-section h2 {
            color: #2c3e50;
            border-bottom: none;
        }
        
        #messagePreview {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 15px;
            line-height: 1.5;
            resize: vertical;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        
        .instructions {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .instructions h3 {
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .note {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Form Jemaat Baru</h1>
            <p class="subtitle">WhatsApp Message Generator</p>
        </header>
        
        <div class="instructions">
            <h3>Petunjuk Penggunaan</h3>
            <p>Isi semua formulir dengan data jemaat baru. Sistem akan menghasilkan pesan WhatsApp yang sudah diformat. Anda dapat mengirim langsung ke Hamba Tuhan atau ke nomor WhatsApp lainnya.</p>
        </div>
        
        <div class="form-section">
            <h2>Data Jemaat Baru</h2>
            
            <div class="form-group">
                <label for="mainName" class="required">Nama Jemaat Baru (Utama)</label>
                <input type="text" id="mainName" placeholder="Masukkan nama lengkap">
                <div class="error-message" id="nameError">Nama jemaat harus diisi</div>
            </div>
            
            <div class="form-group">
                <label for="mainContact" class="required">No. Kontak Jemaat (Utama)</label>
                <input type="tel" id="mainContact" placeholder="Contoh: 081234567890 atau 6281234567890">
                <div class="error-message" id="contactError">No. kontak harus diisi dan hanya berisi angka</div>
            </div>
            
            <div class="form-group">
                <label for="motivation" class="required">Motivasi datang ke gereja</label>
                <textarea id="motivation" rows="4" placeholder="Jelaskan motivasi atau alasan datang ke gereja"></textarea>
                <div class="error-message" id="motivationError">Motivasi harus diisi</div>
            </div>
        </div>
        
        <div class="form-section">
            <h2>Data Jemaat Tambahan (Jika ada)</h2>
            <div id="additionalMembersContainer">
                <!-- Anggota tambahan akan ditambahkan di sini -->
            </div>
            <button type="button" class="btn btn-secondary" id="addMemberBtn">+ Tambah Anggota Keluarga</button>
            <p class="note">Tambahkan anggota keluarga lain yang datang bersama jemaat utama</p>
        </div>
        
        <div class="form-section">
            <h2>Pengiriman WhatsApp</h2>
            
            <div class="form-group">
                <label for="otherNumber">Nomor WA tujuan lainnya (opsional)</label>
                <input type="tel" id="otherNumber" placeholder="Kosongkan jika hanya ingin kirim ke Hamba Tuhan">
                <div class="error-message" id="otherNumberError">No. WhatsApp harus hanya berisi angka</div>
                <p class="note">Isi jika ingin mengirim ke nomor selain Hamba Tuhan (selain +6285245155777)</p>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn btn-whatsapp" id="sendToHambaTuhan">Kirim ke WA Hamba TUHAN</button>
                <button type="button" class="btn btn-success" id="sendToOther">Kirim/Ekspor ke WA Lainnya</button>
                <button type="button" class="btn btn-secondary" id="copyMessage">Copy Pesan</button>
            </div>
            
            <div class="success-message" id="copySuccess">Pesan berhasil disalin ke clipboard!</div>
        </div>
        
        <div class="preview-section">
            <h2>Preview Pesan WhatsApp</h2>
            <p>Pesan akan otomatis terupdate saat Anda mengisi form:</p>
            <textarea id="messagePreview" readonly></textarea>
        </div>
    </div>

    <script>
        // Data dan variabel global
        let additionalMembers = [];
        
        // Nomor WA Hamba TUHAN yang di-hardcode
        // Format: +6285245155777 (tanpa + dan spasi)
        const HAMBA_TUHAN_NUMBER = "6285245155777";
        
        // DOM Elements
        const mainNameInput = document.getElementById('mainName');
        const mainContactInput = document.getElementById('mainContact');
        const motivationInput = document.getElementById('motivation');
        const otherNumberInput = document.getElementById('otherNumber');
        const messagePreview = document.getElementById('messagePreview');
        const additionalMembersContainer = document.getElementById('additionalMembersContainer');
        const addMemberBtn = document.getElementById('addMemberBtn');
        const sendToHambaTuhanBtn = document.getElementById('sendToHambaTuhan');
        const sendToOtherBtn = document.getElementById('sendToOther');
        const copyMessageBtn = document.getElementById('copyMessage');
        
        // Fungsi untuk menormalisasi nomor telepon (0 â†’ 62)
        // Mengonversi nomor yang diawali 0 menjadi 62xxxx
        function normalizePhoneNumber(phone) {
            if (!phone) return '';
            
            // Hapus semua karakter non-angka
            let normalized = phone.replace(/\D/g, '');
            
            // Jika nomor diawali 0, ganti dengan 62
            if (normalized.startsWith('0')) {
                normalized = '62' + normalized.substring(1);
            }
            
            // Jika nomor diawali +62, hapus tanda +
            if (normalized.startsWith('+62')) {
                normalized = normalized.substring(1);
            }
            
            // Pastikan panjang nomor minimal 10 digit
            if (normalized.length < 10) {
                return '';
            }
            
            return normalized;
        }
        
        // Fungsi untuk validasi nomor telepon
        function isValidPhoneNumber(phone) {
            const normalized = normalizePhoneNumber(phone);
            return normalized.length >= 10 && /^\d+$/.test(normalized);
        }
        
        // Fungsi untuk menampilkan pesan error
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        // Fungsi untuk menyembunyikan pesan error
        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = 'none';
        }
        
        // Fungsi untuk validasi form utama
        function validateMainForm() {
            let isValid = true;
            
            // Validasi nama
            if (!mainNameInput.value.trim()) {
                showError('nameError', 'Nama jemaat harus diisi');
                isValid = false;
            } else {
                hideError('nameError');
            }
            
            // Validasi kontak
            if (!mainContactInput.value.trim()) {
                showError('contactError', 'No. kontak harus diisi');
                isValid = false;
            } else if (!isValidPhoneNumber(mainContactInput.value)) {
                showError('contactError', 'No. kontak hanya boleh berisi angka (format: 0812... atau 62812...)');
                isValid = false;
            } else {
                hideError('contactError');
            }
            
            // Validasi motivasi
            if (!motivationInput.value.trim()) {
                showError('motivationError', 'Motivasi harus diisi');
                isValid = false;
            } else {
                hideError('motivationError');
            }
            
            return isValid;
        }
        
        // Fungsi untuk validasi nomor tujuan lainnya
        function validateOtherNumber() {
            const otherNumber = otherNumberInput.value.trim();
            
            if (otherNumber && !isValidPhoneNumber(otherNumber)) {
                showError('otherNumberError', 'No. WhatsApp hanya boleh berisi angka (format: 0812... atau 62812...)');
                return false;
            } else {
                hideError('otherNumberError');
                return true;
            }
        }
        
        // Fungsi untuk menambahkan anggota keluarga baru
        function addMember(name = '', contact = '') {
            const memberId = Date.now(); // ID unik berdasarkan timestamp
            
            const memberElement = document.createElement('div');
            memberElement.className = 'member-item';
            memberElement.id = `member-${memberId}`;
            
            memberElement.innerHTML = `
                <div class="member-header">
                    <h3>Anggota Keluarga</h3>
                    <button type="button" class="remove-member" data-id="${memberId}">Hapus</button>
                </div>
                <div class="form-group">
                    <label for="memberName-${memberId}">Nama Anggota</label>
                    <input type="text" id="memberName-${memberId}" class="member-name" placeholder="Masukkan nama anggota" value="${name}">
                </div>
                <div class="form-group">
                    <label for="memberContact-${memberId}">No. Kontak Anggota</label>
                    <input type="tel" id="memberContact-${memberId}" class="member-contact" placeholder="Kosongkan jika sama dengan kontak utama" value="${contact}">
                </div>
            `;
            
            additionalMembersContainer.appendChild(memberElement);
            
            // Simpan data anggota
            additionalMembers.push({
                id: memberId,
                name: name,
                contact: contact
            });
            
            // Tambahkan event listener untuk input anggota
            const nameInput = document.getElementById(`memberName-${memberId}`);
            const contactInput = document.getElementById(`memberContact-${memberId}`);
            
            nameInput.addEventListener('input', function() {
                updateMemberData(memberId, 'name', this.value);
                updateMessagePreview();
            });
            
            contactInput.addEventListener('input', function() {
                updateMemberData(memberId, 'contact', this.value);
                updateMessagePreview();
            });
            
            // Tambahkan event listener untuk tombol hapus
            const removeBtn = memberElement.querySelector('.remove-member');
            removeBtn.addEventListener('click', function() {
                removeMember(memberId);
            });
        }
        
        // Fungsi untuk memperbarui data anggota
        function updateMemberData(id, field, value) {
            const memberIndex = additionalMembers.findIndex(member => member.id === id);
            if (memberIndex !== -1) {
                additionalMembers[memberIndex][field] = value;
            }
        }
        
        // Fungsi untuk menghapus anggota
        function removeMember(id) {
            // Hapus dari DOM
            const memberElement = document.getElementById(`member-${id}`);
            if (memberElement) {
                memberElement.remove();
            }
            
            // Hapus dari array
            additionalMembers = additionalMembers.filter(member => member.id !== id);
            
            // Update preview
            updateMessagePreview();
        }
        
        // Fungsi untuk menghasilkan pesan WhatsApp
        function generateMessage() {
            const name = mainNameInput.value.trim();
            const contact = normalizePhoneNumber(mainContactInput.value);
            const motivation = motivationInput.value.trim();
            
            let message = "Shalom, saya ingin melaporkan jemaat baru:\n\n";
            message += `Nama: ${name}\n`;
            message += `Kontak: ${contact}\n`;
            message += `Motivasi: ${motivation}\n`;
            
            // Tambahkan data anggota keluarga jika ada
            if (additionalMembers.length > 0) {
                message += "\n--- Anggota Keluarga Lainnya ---\n";
                
                additionalMembers.forEach((member, index) => {
                    if (member.name.trim()) {
                        const memberContact = member.contact.trim() ? ` (Kontak: ${normalizePhoneNumber(member.contact)})` : '';
                        message += `${index + 1}. ${member.name}${memberContact}\n`;
                    }
                });
            }
            
            message += "\nTuhan memberkati.";
            
            return message;
        }
        
        // Fungsi untuk memperbarui preview pesan
        function updateMessagePreview() {
            messagePreview.value = generateMessage();
        }
        
        // Fungsi untuk membuat URL WhatsApp
        function createWhatsAppUrl(phoneNumber, message) {
            // Encode pesan menggunakan encodeURIComponent
            const encodedMessage = encodeURIComponent(message);
            
            // Buat URL wa.me dengan nomor dan pesan ter-encode
            return `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
        }
        
        // Fungsi untuk mengirim ke WhatsApp
        function sendToWhatsApp(phoneNumber) {
            if (!validateMainForm()) {
                alert('Harap perbaiki kesalahan pada form sebelum mengirim.');
                return;
            }
            
            const message = generateMessage();
            const url = createWhatsAppUrl(phoneNumber, message);
            
            // Buka WhatsApp di tab baru
            window.open(url, '_blank');
        }
        
        // Event Listeners
        mainNameInput.addEventListener('input', updateMessagePreview);
        mainContactInput.addEventListener('input', updateMessagePreview);
        motivationInput.addEventListener('input', updateMessagePreview);
        otherNumberInput.addEventListener('input', validateOtherNumber);
        
        addMemberBtn.addEventListener('click', function() {
            addMember();
        });
        
        sendToHambaTuhanBtn.addEventListener('click', function() {
            if (!validateMainForm()) {
                return;
            }
            
            // Kirim ke nomor WA Hamba TUHAN yang sudah di-hardcode
            sendToWhatsApp(HAMBA_TUHAN_NUMBER);
        });
        
        sendToOtherBtn.addEventListener('click', function() {
            if (!validateMainForm()) {
                return;
            }
            
            if (!validateOtherNumber()) {
                return;
            }
            
            const otherNumber = otherNumberInput.value.trim();
            
            if (!otherNumber) {
                alert('Harap isi nomor WhatsApp tujuan lainnya.');
                otherNumberInput.focus();
                return;
            }
            
            const normalizedNumber = normalizePhoneNumber(otherNumber);
            sendToWhatsApp(normalizedNumber);
        });
        
        copyMessageBtn.addEventListener('click', function() {
            if (!validateMainForm()) {
                alert('Harap isi semua field wajib sebelum menyalin pesan.');
                return;
            }
            
            const message = generateMessage();
            
            // Salin ke clipboard menggunakan Clipboard API
            navigator.clipboard.writeText(message)
                .then(() => {
                    // Tampilkan pesan sukses
                    const copySuccess = document.getElementById('copySuccess');
                    copySuccess.style.display = 'block';
                    
                    // Sembunyikan pesan sukses setelah 3 detik
                    setTimeout(() => {
                        copySuccess.style.display = 'none';
                    }, 3000);
                })
                .catch(err => {
                    console.error('Gagal menyalin teks: ', err);
                    alert('Gagal menyalin pesan. Silakan salin manual dari preview.');
                });
        });
        
        // Inisialisasi preview pesan saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            updateMessagePreview();
        });
    </script>
</body>
</html>
