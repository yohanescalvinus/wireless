<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Jemaat Baru - GKY Cibubur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Tema Terang (Default) */
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --secondary-color: #2ecc71;
            --secondary-dark: #27ae60;
            --whatsapp-color: #25D366;
            --whatsapp-dark: #1da851;
            --danger-color: #e74c3c;
            --danger-dark: #c0392b;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --bg-color: #ffffff;
            --bg-light: #f8f9fa;
            --bg-lighter: #f5f5f5;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-text: #e74c3c;
            --transition-speed: 0.3s;
        }

        [data-theme="dark"] {
            /* Tema Gelap */
            --primary-color: #4aa3df;
            --primary-dark: #3498db;
            --secondary-color: #2ecc71;
            --secondary-dark: #27ae60;
            --whatsapp-color: #25D366;
            --whatsapp-dark: #1da851;
            --danger-color: #e74c3c;
            --danger-dark: #c0392b;
            --text-color: #f5f5f5;
            --text-light: #b0b0b0;
            --bg-color: #121212;
            --bg-light: #1e1e1e;
            --bg-lighter: #252525;
            --border-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --card-bg: #1e1e1e;
            --input-bg: #252525;
            --success-bg: #0d3016;
            --success-text: #4caf50;
            --error-text: #f44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            transition: background-color var(--transition-speed), color var(--transition-speed), border-color var(--transition-speed);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header dan Theme Toggle */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 50px;
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-weight: 500;
        }

        .theme-toggle i {
            font-size: 1.2rem;
        }

        .theme-text {
            font-size: 0.9rem;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 2rem;
            font-weight: 700;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* Container Utama */
        .container {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow-color);
            padding: 30px;
            margin-bottom: 30px;
            flex-grow: 1;
        }

        /* Form Sections */
        .form-section {
            margin-bottom: 35px;
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 i {
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 1rem;
        }

        .required::after {
            content: " *";
            color: var(--danger-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        /* Anggota Keluarga */
        .member-item {
            background-color: var(--bg-light);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .member-header h3 {
            color: var(--text-color);
            font-size: 1.1rem;
        }

        .remove-member {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 14px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .remove-member:hover {
            background-color: var(--danger-dark);
        }

        /* Counter Anggota Keluarga */
        .family-counter {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: var(--bg-light);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
            border: 1px solid var(--border-color);
        }

        .family-counter i {
            color: var(--primary-color);
        }

        /* Tombol-tombol */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 28px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background-color: var(--secondary-color);
        }

        .btn-success:hover {
            background-color: var(--secondary-dark);
        }

        .btn-whatsapp {
            background-color: var(--whatsapp-color);
        }

        .btn-whatsapp:hover {
            background-color: var(--whatsapp-dark);
        }

        .btn-secondary {
            background-color: var(--text-light);
        }

        .btn-secondary:hover {
            background-color: #6c757d;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }

        /* Preview Pesan */
        .preview-section {
            background-color: var(--bg-light);
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid var(--border-color);
        }

        #messagePreview {
            width: 100%;
            min-height: 200px;
            padding: 18px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            line-height: 1.5;
            resize: vertical;
            margin-top: 15px;
            white-space: pre-wrap;
            color: var(--text-color);
        }

        /* Pesan Error dan Sukses */
        .error-message {
            color: var(--error-text);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            background-color: var(--success-bg);
            color: var(--success-text);
            padding: 14px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        /* Petunjuk */
        .instructions {
            background-color: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary-color);
        }

        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .note {
            font-size: 0.9rem;
            color: var(--text-light);
            font-style: italic;
            margin-top: 5px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 25px 0;
            color: var(--text-light);
            font-size: 0.95rem;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }

        /* Responsif */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 20px;
            }
            
            .header-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .theme-toggle {
                align-self: flex-end;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.6rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .family-counter {
                margin-left: 5px;
                padding: 4px 8px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="header-container">
        <div>
            <h1>Form Jemaat Baru</h1>
            <p class="subtitle">GKY Cibubur</p>
        </div>
        <div class="theme-toggle" id="themeToggle">
            <i class="fas fa-sun"></i>
            <span class="theme-text">Mode Terang</span>
        </div>
    </div>
    
    <div class="container">
        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> Petunjuk Penggunaan</h3>
            <p>Isi semua formulir dengan data jemaat baru. Sistem akan menghasilkan pesan WhatsApp yang sudah diformat. Anda dapat mengirim langsung ke Hamba Tuhan atau ke nomor WhatsApp lainnya.</p>
            <p><strong>Catatan:</strong> Pesan akan menampilkan jumlah jemaat baru secara otomatis berdasarkan jumlah anggota keluarga yang didaftarkan.</p>
        </div>
        
        <div class="form-section">
            <h2><i class="fas fa-user-plus"></i> Data Jemaat Baru</h2>
            
            <div class="form-group">
                <label for="mainName" class="required">Nama Jemaat Baru (Utama)</label>
                <input type="text" id="mainName" placeholder="Masukkan nama lengkap">
                <div class="error-message" id="nameError">Nama jemaat harus diisi</div>
            </div>
            
            <div class="form-group">
                <label for="mainContact" class="required">No. Kontak Jemaat (Utama)</label>
                <input type="tel" id="mainContact" placeholder="Contoh: 081234567890 atau 6281234567890">
                <div class="error-message" id="contactError">No. kontak harus diisi dan hanya berisi angka</div>
            </div>
            
            <div class="form-group">
                <label for="motivation" class="required">Motivasi datang ke gereja</label>
                <textarea id="motivation" rows="4" placeholder="Jelaskan motivasi atau alasan datang ke gereja"></textarea>
                <div class="error-message" id="motivationError">Motivasi harus diisi</div>
            </div>
        </div>
        
        <div class="form-section">
            <h2>
                <i class="fas fa-users"></i> Data Jemaat Tambahan (Jika ada)
                <div class="family-counter" id="familyCounter">
                    <i class="fas fa-user-friends"></i>
                    <span id="familyCount">0 Anggota Keluarga</span>
                </div>
            </h2>
            <div id="additionalMembersContainer">
                <!-- Anggota tambahan akan ditambahkan di sini -->
            </div>
            <button type="button" class="btn btn-secondary" id="addMemberBtn">
                <i class="fas fa-user-plus"></i> Tambah Anggota Keluarga
            </button>
            <p class="note">Tambahkan anggota keluarga lain yang datang bersama jemaat utama. Setiap anggota akan dihitung dalam total jemaat baru.</p>
        </div>
        
        <div class="form-section">
            <h2><i class="fas fa-paper-plane"></i> Pengiriman WhatsApp</h2>
            
            <div class="form-group">
                <label for="otherNumber">Nomor WA tujuan lainnya (opsional)</label>
                <input type="tel" id="otherNumber" placeholder="Kosongkan jika hanya ingin kirim ke Hamba Tuhan">
                <div class="error-message" id="otherNumberError">No. WhatsApp harus hanya berisi angka</div>
                <p class="note">Isi jika ingin mengirim ke nomor selain Hamba Tuhan (selain +6285245155777)</p>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn btn-whatsapp" id="sendToHambaTuhan">
                    <i class="fab fa-whatsapp"></i> Kirim ke WA Hamba TUHAN
                </button>
                <button type="button" class="btn btn-success" id="sendToOther">
                    <i class="fas fa-share"></i> Kirim/Ekspor ke WA Lainnya
                </button>
                <button type="button" class="btn btn-secondary" id="copyMessage">
                    <i class="far fa-copy"></i> Copy Pesan
                </button>
            </div>
            
            <div class="success-message" id="copySuccess">
                <i class="fas fa-check-circle"></i>
                <span>Pesan berhasil disalin ke clipboard!</span>
            </div>
        </div>
        
        <div class="preview-section">
            <h2><i class="far fa-eye"></i> Preview Pesan WhatsApp</h2>
            <p>Pesan akan otomatis terupdate saat Anda mengisi form:</p>
            <textarea id="messagePreview" readonly></textarea>
        </div>
    </div>
    
    <footer>
        © 2026 Sistem Absensi Jemaat GKY CIBUBUR
    </footer>

    <script>
        // Data dan variabel global
        let additionalMembers = [];
        let currentTheme = 'light';
        
        // Nomor WA Hamba TUHAN yang di-hardcode
        // Format: +6285245155777 (tanpa + dan spasi)
        const HAMBA_TUHAN_NUMBER = "6285245155777";
        
        // DOM Elements
        const mainNameInput = document.getElementById('mainName');
        const mainContactInput = document.getElementById('mainContact');
        const motivationInput = document.getElementById('motivation');
        const otherNumberInput = document.getElementById('otherNumber');
        const messagePreview = document.getElementById('messagePreview');
        const additionalMembersContainer = document.getElementById('additionalMembersContainer');
        const addMemberBtn = document.getElementById('addMemberBtn');
        const sendToHambaTuhanBtn = document.getElementById('sendToHambaTuhan');
        const sendToOtherBtn = document.getElementById('sendToOther');
        const copyMessageBtn = document.getElementById('copyMessage');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        const themeText = themeToggle.querySelector('.theme-text');
        const familyCountElement = document.getElementById('familyCount');
        const familyCounter = document.getElementById('familyCounter');
        
        // Fungsi untuk menginisialisasi tema
        function initializeTheme() {
            const savedTheme = localStorage.getItem('jemaat-theme');
            
            if (savedTheme) {
                currentTheme = savedTheme;
            } else {
                // Deteksi preferensi tema sistem
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                currentTheme = prefersDark ? 'dark' : 'light';
            }
            
            applyTheme();
        }
        
        // Fungsi untuk menerapkan tema
        function applyTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('jemaat-theme', currentTheme);
            
            // Update ikon dan teks toggle
            if (currentTheme === 'dark') {
                themeIcon.className = 'fas fa-moon';
                themeText.textContent = 'Mode Gelap';
            } else {
                themeIcon.className = 'fas fa-sun';
                themeText.textContent = 'Mode Terang';
            }
        }
        
        // Fungsi untuk mengganti tema
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme();
        }
        
        // Fungsi untuk menghitung jumlah anggota keluarga yang valid
        function countValidFamilyMembers() {
            // Hitung anggota keluarga yang memiliki nama (tidak kosong)
            const validMembers = additionalMembers.filter(member => 
                member.name && member.name.trim() !== ''
            ).length;
            
            return validMembers;
        }
        
        // Fungsi untuk memperbarui tampilan counter keluarga
        function updateFamilyCounter() {
            const validCount = countValidFamilyMembers();
            familyCountElement.textContent = `${validCount} Anggota Keluarga`;
            
            // Update warna counter berdasarkan jumlah
            if (validCount > 0) {
                familyCounter.style.backgroundColor = 'var(--primary-color)';
                familyCounter.style.color = 'white';
                familyCounter.querySelector('i').style.color = 'white';
            } else {
                familyCounter.style.backgroundColor = 'var(--bg-light)';
                familyCounter.style.color = 'var(--text-color)';
                familyCounter.querySelector('i').style.color = 'var(--primary-color)';
            }
        }
        
        // Fungsi untuk menormalisasi nomor telepon (0 → 62)
        // Mengonversi nomor yang diawali 0 menjadi 62xxxx
        function normalizePhoneNumber(phone) {
            if (!phone) return '';
            
            // Hapus semua karakter non-angka
            let normalized = phone.replace(/\D/g, '');
            
            // Jika nomor diawali 0, ganti dengan 62
            if (normalized.startsWith('0')) {
                normalized = '62' + normalized.substring(1);
            }
            
            // Jika nomor diawali +62, hapus tanda +
            if (normalized.startsWith('+62')) {
                normalized = normalized.substring(1);
            }
            
            // Pastikan panjang nomor minimal 10 digit
            if (normalized.length < 10) {
                return '';
            }
            
            return normalized;
        }
        
        // Fungsi untuk validasi nomor telepon
        function isValidPhoneNumber(phone) {
            const normalized = normalizePhoneNumber(phone);
            return normalized.length >= 10 && /^\d+$/.test(normalized);
        }
        
        // Fungsi untuk menampilkan pesan error
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        // Fungsi untuk menyembunyikan pesan error
        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = 'none';
        }
        
        // Fungsi untuk validasi form utama
        function validateMainForm() {
            let isValid = true;
            
            // Validasi nama
            if (!mainNameInput.value.trim()) {
                showError('nameError', 'Nama jemaat harus diisi');
                isValid = false;
            } else {
                hideError('nameError');
            }
            
            // Validasi kontak
            if (!mainContactInput.value.trim()) {
                showError('contactError', 'No. kontak harus diisi');
                isValid = false;
            } else if (!isValidPhoneNumber(mainContactInput.value)) {
                showError('contactError', 'No. kontak hanya boleh berisi angka (format: 0812... atau 62812...)');
                isValid = false;
            } else {
                hideError('contactError');
            }
            
            // Validasi motivasi
            if (!motivationInput.value.trim()) {
                showError('motivationError', 'Motivasi harus diisi');
                isValid = false;
            } else {
                hideError('motivationError');
            }
            
            return isValid;
        }
        
        // Fungsi untuk validasi nomor tujuan lainnya
        function validateOtherNumber() {
            const otherNumber = otherNumberInput.value.trim();
            
            if (otherNumber && !isValidPhoneNumber(otherNumber)) {
                showError('otherNumberError', 'No. WhatsApp hanya boleh berisi angka (format: 0812... atau 62812...)');
                return false;
            } else {
                hideError('otherNumberError');
                return true;
            }
        }
        
        // Fungsi untuk menambahkan anggota keluarga baru
        function addMember(name = '', contact = '') {
            const memberId = Date.now(); // ID unik berdasarkan timestamp
            
            const memberElement = document.createElement('div');
            memberElement.className = 'member-item';
            memberElement.id = `member-${memberId}`;
            
            memberElement.innerHTML = `
                <div class="member-header">
                    <h3><i class="fas fa-user"></i> Anggota Keluarga</h3>
                    <button type="button" class="remove-member" data-id="${memberId}">
                        <i class="fas fa-trash"></i> Hapus
                    </button>
                </div>
                <div class="form-group">
                    <label for="memberName-${memberId}">Nama Anggota</label>
                    <input type="text" id="memberName-${memberId}" class="member-name" placeholder="Masukkan nama anggota" value="${name}">
                </div>
                <div class="form-group">
                    <label for="memberContact-${memberId}">No. Kontak Anggota</label>
                    <input type="tel" id="memberContact-${memberId}" class="member-contact" placeholder="Kosongkan jika sama dengan kontak utama" value="${contact}">
                </div>
            `;
            
            additionalMembersContainer.appendChild(memberElement);
            
            // Simpan data anggota
            additionalMembers.push({
                id: memberId,
                name: name,
                contact: contact
            });
            
            // Tambahkan event listener untuk input anggota
            const nameInput = document.getElementById(`memberName-${memberId}`);
            const contactInput = document.getElementById(`memberContact-${memberId}`);
            
            nameInput.addEventListener('input', function() {
                updateMemberData(memberId, 'name', this.value);
                updateFamilyCounter();
                updateMessagePreview();
            });
            
            contactInput.addEventListener('input', function() {
                updateMemberData(memberId, 'contact', this.value);
                updateMessagePreview();
            });
            
            // Tambahkan event listener untuk tombol hapus
            const removeBtn = memberElement.querySelector('.remove-member');
            removeBtn.addEventListener('click', function() {
                removeMember(memberId);
            });
            
            // Update counter keluarga
            updateFamilyCounter();
        }
        
        // Fungsi untuk memperbarui data anggota
        function updateMemberData(id, field, value) {
            const memberIndex = additionalMembers.findIndex(member => member.id === id);
            if (memberIndex !== -1) {
                additionalMembers[memberIndex][field] = value;
            }
        }
        
        // Fungsi untuk menghapus anggota
        function removeMember(id) {
            // Hapus dari DOM
            const memberElement = document.getElementById(`member-${id}`);
            if (memberElement) {
                memberElement.remove();
            }
            
            // Hapus dari array
            additionalMembers = additionalMembers.filter(member => member.id !== id);
            
            // Update counter dan preview
            updateFamilyCounter();
            updateMessagePreview();
        }
        
        // Fungsi untuk menghasilkan pesan WhatsApp dengan header jumlah jemaat
        function generateMessage() {
            const name = mainNameInput.value.trim();
            const contact = normalizePhoneNumber(mainContactInput.value);
            const motivation = motivationInput.value.trim();
            
            // Hitung total jemaat (jemaat utama + anggota keluarga yang valid)
            const validMembersCount = countValidFamilyMembers();
            const totalJemaat = 1 + validMembersCount; // 1 untuk jemaat utama
            
            // Buat header berdasarkan jumlah jemaat
            let header = "";
            if (totalJemaat === 1) {
                header = "1 Jemaat Baru\n";
            } else {
                header = `${totalJemaat} Jemaat Baru dalam 1 Keluarga\n`;
            }
            
            let message = `${header}\n`;
            message += "Shalom, saya ingin melaporkan jemaat baru:\n\n";
            message += `Nama: ${name}\n`;
            message += `Kontak: ${contact}\n`;
            message += `Motivasi: ${motivation}\n`;
            
            // Tambahkan data anggota keluarga jika ada
            if (validMembersCount > 0) {
                message += "\n--- Anggota Keluarga Lainnya ---\n";
                
                let memberIndex = 1;
                additionalMembers.forEach((member) => {
                    if (member.name && member.name.trim()) {
                        const memberContact = member.contact.trim() ? ` (Kontak: ${normalizePhoneNumber(member.contact)})` : '';
                        message += `${memberIndex}. ${member.name.trim()}${memberContact}\n`;
                        memberIndex++;
                    }
                });
            }
            
            message += "\nTuhan memberkati.";
            
            return message;
        }
        
        // Fungsi untuk memperbarui preview pesan
        function updateMessagePreview() {
            messagePreview.value = generateMessage();
        }
        
        // Fungsi untuk membuat URL WhatsApp
        function createWhatsAppUrl(phoneNumber, message) {
            // Encode pesan menggunakan encodeURIComponent
            const encodedMessage = encodeURIComponent(message);
            
            // Buat URL wa.me dengan nomor dan pesan ter-encode
            return `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
        }
        
        // Fungsi untuk mengirim ke WhatsApp
        function sendToWhatsApp(phoneNumber) {
            if (!validateMainForm()) {
                alert('Harap perbaiki kesalahan pada form sebelum mengirim.');
                return;
            }
            
            const message = generateMessage();
            const url = createWhatsAppUrl(phoneNumber, message);
            
            // Buka WhatsApp di tab baru
            window.open(url, '_blank');
        }
        
        // Event Listeners
        mainNameInput.addEventListener('input', function() {
            updateMessagePreview();
        });
        
        mainContactInput.addEventListener('input', function() {
            updateMessagePreview();
        });
        
        motivationInput.addEventListener('input', function() {
            updateMessagePreview();
        });
        
        otherNumberInput.addEventListener('input', validateOtherNumber);
        
        addMemberBtn.addEventListener('click', function() {
            addMember();
            updateMessagePreview();
        });
        
        sendToHambaTuhanBtn.addEventListener('click', function() {
            if (!validateMainForm()) {
                return;
            }
            
            // Kirim ke nomor WA Hamba TUHAN yang sudah di-hardcode
            sendToWhatsApp(HAMBA_TUHAN_NUMBER);
        });
        
        sendToOtherBtn.addEventListener('click', function() {
            if (!validateMainForm()) {
                return;
            }
            
            if (!validateOtherNumber()) {
                return;
            }
            
            const otherNumber = otherNumberInput.value.trim();
            
            if (!otherNumber) {
                alert('Harap isi nomor WhatsApp tujuan lainnya.');
                otherNumberInput.focus();
                return;
            }
            
            const normalizedNumber = normalizePhoneNumber(otherNumber);
            sendToWhatsApp(normalizedNumber);
        });
        
        copyMessageBtn.addEventListener('click', function() {
            if (!validateMainForm()) {
                alert('Harap isi semua field wajib sebelum menyalin pesan.');
                return;
            }
            
            const message = generateMessage();
            
            // Salin ke clipboard menggunakan Clipboard API
            navigator.clipboard.writeText(message)
                .then(() => {
                    // Tampilkan pesan sukses
                    const copySuccess = document.getElementById('copySuccess');
                    copySuccess.style.display = 'flex';
                    
                    // Sembunyikan pesan sukses setelah 3 detik
                    setTimeout(() => {
                        copySuccess.style.display = 'none';
                    }, 3000);
                })
                .catch(err => {
                    console.error('Gagal menyalin teks: ', err);
                    alert('Gagal menyalin pesan. Silakan salin manual dari preview.');
                });
        });
        
        // Toggle tema
        themeToggle.addEventListener('click', toggleTheme);
        
        // Inisialisasi tema dan preview pesan saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            updateFamilyCounter();
            updateMessagePreview();
        });
    </script>
</body>
</html>
